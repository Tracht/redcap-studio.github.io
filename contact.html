<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redcap Studio — Contact</title>

  <link rel="icon" type="image/png" href="assets/images/favicon.png">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="preload" as="image" href="assets/images/logo.png">
</head>

<body>
  <header class="site-header">
    <div class="header-inner container">
       <div class="logo-container"><a class="logo-link" href="index.html">
        <img src="assets/images/logo.png" alt="Redcap Studio" class="logo" width="40" height="40" loading="eager" decoding="async">
      </a>
      <p class="site-title">Redcap Studio</p></div>

      <input type="checkbox" id="nav-toggle" class="nav-toggle">
      <label for="nav-toggle" class="nav-toggle-label">
        <span></span>
        <span></span>
        <span></span>
      </label>

      <nav class="main-nav" aria-label="Main navigation">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="contact.html" aria-current="page">Contact</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="container">
        <h1>Contact Us</h1>
        <p class="lede">Contact us for fast mobile app development</p>

        <form id="contactForm" class="contact-form" novalidate>
          <label>
            <span class="label-text">Name</span>
            <input type="text" name="name" placeholder="Your name">
          </label>

          <label>
            <span class="label-text">Your Email (required)</span>
            <input type="email" name="email" placeholder="yourname@example.com" required>
          </label>

          <label>
            <span class="label-text">Message (required)</span>
            <textarea name="message" id="message" rows="6" placeholder="Tell us about your project" required></textarea>
          </label>

          <!-- Honeypot -->
          <input type="text" name="company" id="company" autocomplete="off" style="display:none;">

          <button type="submit" class="btn">Send Message</button>

          <p id="form-status" class="form-status"></p>
        </form>

      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
     <p>© Redcap Studio</p>
    </div>
  </footer>

<!-- --------------- SCRIPT FIXED AND MOVED HERE ------------------- -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.querySelector(".contact-form");
  const status = document.getElementById("form-status");
  const submitBtn = form.querySelector("button[type='submit']");
  let isSubmitting = false;

  const MAX_SUBMISSIONS = 3;
  const COOLDOWN_TIME = 60000;
  const STORAGE_KEY = "contact-form-ratelimit";

  function loadRateLimit() {
    const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    return {
      count: data.count || 0,
      lastSubmission: data.lastSubmission || 0
    };
  }

  function saveRateLimit(count) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      count,
      lastSubmission: Date.now()
    }));
  }

  function checkCooldown() {
    const { count, lastSubmission } = loadRateLimit();
    if (count < MAX_SUBMISSIONS) return 0;
    const elapsed = Date.now() - lastSubmission;
    return Math.max(0, COOLDOWN_TIME - elapsed);
  }

  function showStatus(message, type) {
    status.textContent = message;
    status.className = "form-status " + type;
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (isSubmitting) return;

    const cooldown = checkCooldown();
    if (cooldown > 0) {
      showStatus(`Too many submissions. Try again in ${Math.ceil(cooldown / 1000)}s.`, "cooldown");
      return;
    }

    if (document.getElementById("company").value.trim() !== "") {
      showStatus("Spam detected.", "error");
      return;
    }

    const email = form.querySelector("input[name='email']").value.trim();
    const message = form.querySelector("textarea[name='message']").value.trim();
    if (!email || !message) {
      showStatus("Please fill out required fields.", "error");
      return;
    }

    isSubmitting = true;
    submitBtn.disabled = true;
    submitBtn.style.opacity = 0.6;
    submitBtn.textContent = "Sending...";

    try {
      const response = await fetch("https://formsubmit.co/ajax/redcap.studio.mt@gmail.com", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name,
          email,
          message,
          _subject: "New Contact Form Message",
          _template: "table"
        })
      });

      const data = await response.json();

      if (data.success) {
        showStatus("Email sent! Thanks for your message.", "success");
        form.reset();
        const { count } = loadRateLimit();
        saveRateLimit(count + 1);
      } else {
        showStatus("Error sending message.", "error");
      }
    } catch (err) {
      showStatus("Network error. Try again later.", "error");
    } finally {
      isSubmitting = false;
      submitBtn.disabled = false;
      submitBtn.style.opacity = 1;
      submitBtn.textContent = "Send Message";
    }
  });
});
</script>

</body>
</html>
